---
title: "Final Project RMD"
author: "Alexis Adams-Clark"
date: "11/14/2018"
output: html_document
---

```{r setup, include=FALSE, warning = FALSE, messages = FALSE}
#Load libraries
library(rio)
library(tidyverse)
library(here)
library(dplyr)
library(knitr)
library(janitor)
library(forcats)
```

```{r import data, echo = FALSE}
#Import data
list(here())
data <- import(here("Data", "Final_project_simulated_data.csv"))
#View(data)
```

####  Data visualizations
```{r Data visualization and summary 1}
#Calculate total scores

data <- data %>% 
  clean_names() %>% 
  mutate(ses = factor(ses), 
         ed = as.factor(ed),
         en = as.factor(en))

#sq = sleep quality, mdd = major depression, ql = quality of life

data <- data %>% 
  mutate(sq_total = sq1 + sq2 + sq3 + sq4, 
         mdd_total = mdd1 + mdd2 + mdd3,
         ql_total = ql1 + ql2 + ql3)

#Grouping by SES and creating a summary of MDD, SQ, and QL total scores
scorebyses <- data %>% 
  group_by(ses) %>% 
  summarize(mean_mdd = mean(mdd_total),
            mean_sq = mean(sq_total),
            mean_ql = mean(ql_total))

#Table summary
kable(scorebyses, format = "html", digits = round(2))

#Bar graph of MDD scores by SES
levels(scorebyses$ses)
scorebyses <- scorebyses %>% 
  mutate(ses = fct_recode(ses, "High" = "HighSES", 
                               "Med" = "MiddleSES",
                               "Low" = "LowSES"))

scorebyses$ses <- factor(scorebyses$ses, levels = c("Low", "Med", "High"))

ggplot(scorebyses, aes(x = ses, y = mean_mdd, fill = ses)) + 
  geom_col(alpha = 0.7) + 
  theme_minimal() + 
  labs(title = "Depression Scores by SES", y = "MDD Total Score", x = "Socioeconomic Status") + 
  guides(fill=FALSE)
```

```{r Data visualization 2}
#Select and filter data
data_p <- data %>%  
                select(id, ses, en, sq_total, mdd_total, ql_total) %>% 
                filter(ses == "LowSES")

#Scatterplot of sleep quality vs. depression
ggplot(data_p, aes(x = sq_total, y = mdd_total)) + 
  geom_point(position = "jitter", aplha = 0.7) + 
  geom_smooth(method = "lm") +
  theme_minimal() + 
  labs(title = "Sleep Quality vs. Depression in low SES individuals",
       x = "Sleep Quality", 
       y = "Depression")

#Scatterplot of quality of life vs. depression
ggplot(data_p, aes(x = sq_total, y = ql_total)) + 
  geom_point(position = "jitter", aplha = 0.7) + 
  geom_smooth(method = "lm") +
  theme_minimal() + 
  labs(title = "Sleep Quality vs. Quality of Life in low SES individuals",
       x = "Sleep Quality", 
       y = "Quality of Life")

#Scatterplot of quality of life vs. depression
ggplot(data_p, aes(x =ql_total, y = mdd_total)) + 
  geom_point(position = "jitter", aplha = 0.7) + 
  geom_smooth(method = "lm") +
  theme_minimal() + 
  labs(title = "Quality of Life vs. Depression in low SES individuals",
       x = "Quality of Life", 
       y = "Depression")
```

The mean total depression score for the sample is `r round(mean(data$mdd_total), 2)` . The mean total sleep quality score for the sample is `r round(mean(data$sq_total), 2)`. The mean quality of life score for the sample is`r round(mean(data$ql_total),2)`. 

#### Demonstrate tidying messy data
```{r gather, separate, select, filter & spread}
# this may not be actually helpful with data analysis but it demonstrates how to run those functions
Main_measure_data <- data %>%
  select(id, sq1:ql3) %>% 
  gather(items, value, -1) %>% 
  separate(items, c("Measure", "Item number"), sep = "(?=[:digit:])", convert = TRUE)

# again, not really helpful output but it shows how we have different columns for each race/ethnicity
EN_data <- data %>%
  select(id, ses:en) %>% 
  spread(key = en, value = ses) %>% 
  filter(ed == "Postsecondary certificate")
```
