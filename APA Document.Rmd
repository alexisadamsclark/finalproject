---
title             : "Final Project: The Relationship between Sleep, Depression, Quality of Life, and Socioeconomic Status"
shorttitle        : "Final Project"

author: 
  - name          : "Alexis Adams-Clark"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "1585 E 13th Ave, Straub 339, Eugene, OR 97403"
    email         : "aadamscl@uoregon.edu"
  - name          : "Andrew Fridman"
    affiliation   : "1"
  - name          : "Xi Yang"
    affiliation   : "1"

affiliation:
  - id            : "1"
    institution   : "University of Oregon Department of Psychology"

authornote: |

  We would like to acknowledge Daniel Anderson for introducing us to Papaja and thank our classmates in Introduction to Data Science with R.

abstract: |
  One or two sentences providing a **basic introduction** to the field,  comprehensible to a scientist in any discipline.
  
  Two to three sentences of **more detailed background**, comprehensible  to scientists in related disciplines.
  
  One sentence clearly stating the **general problem** being addressed by  this particular study.
  
  One sentence summarizing the main result (with the words "**here we show**" or their equivalent).
  
  Two or three sentences explaining what the **main result** reveals in direct comparison to what was thought to be the case previously, or how the  main result adds to previous knowledge.
  
  One or two sentences to put the results into a more **general context**.
  
  Two or three sentences to provide a **broader perspective**, readily comprehensible to a scientist in any discipline.
  
  <!-- https://tinyurl.com/ybremelq -->
  
keywords          : "sleep, depression, quality of life, SES"
wordcount         : "X"

bibliography      : ["r-references.bib"]

floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : no
mask              : no
draft             : no

documentclass     : "apa6"
classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
library("papaja")
```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```


# Methods\footnote{This is a fictional Methods section, as we simulated our data. However, this is a realistic way that we could go about collecting this information in the future}

## Participants
Participants were recruited through the University of Oregon Human Subjects Pool consisting of undergraduate students enrolled in introductory psychology and linguistics courses. Students received academic credit in exchange for their participants. Participants were not aware of the subject of the study before scheduling their participation, so participants did not self-select into the study. Although they could leave the study after reading informed consent, no participants chose to do so. 

In total, [#] participants were included in this study, all of who had complete data. [i need to insert demographic characteristics]

## Materials

###Depressive Symptoms Scale

A scale to measure depressive symptoms was created by the researchers for the purposes of this study. Participants were instructed to rate each item on Likert-type scale, where 1 corresponds to “strongly disagree,” and 5 corresponds to “strongly agree.” The scale consisted of three items, including: “Over the last 2 weeks, I have felt little interest or pleasure in doing things;” “Over the last 2 weeks, I have felt down, depressed, or hopeless;” and “Over the last 2 weeks, I have felt tired or had little energy.” Scale items were summed to create a depression score, where higher scores represent higher depressive symptoms.

###Quality of Life Scale
A scale to measure participants’ quality of life was created by the researchers. Participants were instructed to rate each item on Likert-type scale, where 1 corresponds to “strongly disagree,” and 5 corresponds to “strongly agree.” The scale consisted of four items, including: “My life is ideal;” “I am satisfied with my life;” “So far I have been able get the important things I want from life;” and “I have accomplished many of the things in my life.” Scale items were summed to create a total quality of life score, where higher scores represent better quality of life.

###Sleep Quality Scale
A scale to measure participants’ sleep quality was created by the researchers. Participants were instructed to rate each item on Likert-type scale, where 1 corresponds to “strongly disagree,” and 5 corresponds to “strongly agree.” The scale consisted of three items, including: “I am satisfied with the time I spend sleeping;” “I am satisfied with my quality of sleep”; and “When I wake up, I feel refreshed.” Scale items were summed to create a total sleep quality score, where higher scores represent better sleep quality. 


###Demographics Questionnaire
Participants were also asked to complete a demongraphics quationnaire, which asked about their socioeconomic status, race/ethnicity, and educational background. 

## Procedure

An online version of this study was created through Qualtrics survey software, and the
survey link was distributed to participants on the via SONA software through the University of Oregon Human Subjects pool. After clicking the survey link, participants were informed of study procedures and content through an informed consent process. After completing the study, participants received academic credit as compensation and were presented with debriefing materials. The University of Oregon's s Office of Research Compliance (Institutional Review Board) approved this study. 

## Data analysis
We used `r cite_r("r-references.bib")` for all our analyses. We calculated means and standard deviations for each of the total scale scores. We also calculated Pearson's r correlation coefficients between depressive symptoms, quality of life, and sleep quality total scores. The authors interpreted our correlational results as small (.10-.29), medium (.30-.49), and large correlations (.50-1.00).


# Results
```{r results, include = FALSE, message = FALSE, error = FALSE}
library(rio)
library(tidyverse)
library(here)
library(knitr)
library(janitor)
library(forcats)
library(Hmisc)
library(gridExtra)
library(kableExtra)
theme_set(theme_minimal())

#Import data
list(here())
data <- import(here("Data", "Final_project_simulated_data.csv"))

#Clean names, make lowercase
data <- data %>% 
  clean_names() %>% 
  mutate(ses = as.factor(ses), 
         ed = as.factor(ed),
         en = as.factor(en),
         sq1 = as.numeric(sq1),
         sq2 = as.numeric(sq2),
         sq3 = as.numeric(sq3), 
         sq4 = as.numeric(sq4),
         mdd1 = as.numeric(mdd1),
         mdd2 = as.numeric(mdd2),
         mdd3 = as.numeric(mdd3),
         ql1 = as.numeric(ql1),
         ql2 = as.numeric(ql2),
         ql3 = as.numeric(ql3))

#Create total scores
#sq = sleep quality, mdd = major depression, ql = quality of life
data <- data %>% 
  mutate(sq_total = sq1 + sq2 + sq3 + sq4, 
         mdd_total = mdd1 + mdd2 + mdd3,
         ql_total = ql1 + ql2 + ql3)

#Grouping by ses and creating a summary of Depression (mdd), Sleep Quality (sq), and Quality of Life (ql) total scores
scorebyses <- data %>% 
  group_by(ses) %>% 
  dplyr::summarize(mean_mdd = mean(mdd_total),
            mean_sq = mean(sq_total),
            mean_ql = mean(ql_total))

#Change levels of ses
levels(scorebyses$ses)
scorebyses <- scorebyses %>% 
  mutate(ses = fct_recode(ses, "High" = "HighSES", 
                               "Med" = "MiddleSES",
                               "Low" = "LowSES"))

scorebyses$ses <- factor(scorebyses$ses, levels = c("Low", "Med", "High"))

scorebyses <- scorebyses %>% 
  rename(`Mean Depression Score` = mean_mdd,
         `Mean Sleep Quality Score` = mean_sq,
         `Mean Quality of Life Score` = mean_ql,
          SES = ses)
```

```{r Table 1, results = "asis"}

apa_table(scorebyses, 
          caption = "Mean Depression, Sleep Quality, and Quality of Life Scores by SES Group.",  
          note = "This table was created with apa_table()",
          align = "c")

```

```{r Plot 1, echo = FALSE}

pp1 <- ggplot(scorebyses, aes(x = SES, y = `Mean Depression Score`, fill = SES)) + 
  geom_col(alpha = 0.7, width = 0.5) + 
  labs(y = "Depression", 
       x = "Socioeconomic Status") + 
       guides(fill=FALSE)

pp2 <- ggplot(scorebyses, aes(x = SES, y = `Mean Sleep Quality Score`, fill = SES)) + 
  geom_col(alpha = 0.7, width = 0.5) + 
  labs(y = "Sleep Quality", 
       x = "Socioeconomic Status") + 
       guides(fill=FALSE)

pp3 <- ggplot(scorebyses, aes(x = SES, y = `Mean Quality of Life Score`, fill = SES)) + 
  geom_col(alpha = 0.7, width = 0.5) + 
  labs( y = "Quality of Life", 
       x = "Socioeconomic Status") + 
       guides(fill=FALSE)

sp_grid <- grid.arrange(pp1, pp2, pp3, 
                        ncol = 1,
                        top = "Mean Depression, Sleep Quality, and Quality of Life Scores by Socioeconomic Status")
```

##Descriptive Statistics
The mean depression total score for the sample is `r round(mean(data$mdd_total), 2)` . The mean sleep quality total score for the sample is `r round(mean(data$sq_total), 2)`. The mean quality of life total score for the sample is `r round(mean(data$ql_total), 2)`. Mean total scores separated by socioeconomic status are listed in Table 1 and graphically displayed in Figure 1. 

##Correlation Results
Depressive symptoms, sleep quality, and quality of life scores were significantly correlated with each other, *p* < .05 (see Table 2). 

##Exploratory Analyses in Low SES Individuals
The relationships between these depressive symptoms, sleep quality, and quality of life scores in low SES individuals are displayed in Figure 2. [need to input tidied and spread data in low SES individuals and I need to mess with aspect ratios of figures]

```{r correlations, include = FALSE}
#Correlations between the three outome variables
data_corr <- data %>% 
  select(ends_with("total"))
data_corr <- data_corr%>% 
  rename(`Depression` = mdd_total,
         `Sleep Quality` = sq_total,
         `Quality of Life` = ql_total)

corr <- cor(data_corr)

library(Hmisc)

flattenCorrMatrix <- function(cormat, pmat) {
  ut <- upper.tri(cormat)
  data.frame(
    row = rownames(cormat)[row(cormat)[ut]],
    column = rownames(cormat)[col(cormat)[ut]],
    cor  =(cormat)[ut],
    p = pmat[ut]
    )
}

r <- rcorr(as.matrix(data_corr))
r2 <- flattenCorrMatrix(r$r, r$P)

data_p <- data %>%  
                select(id, ses, en, sq_total, mdd_total, ql_total) %>% 
                filter(ses == "LowSES")
```

```{r correlations table, results = "asis"}
apa_table(r2, caption = "Correlations between Depression, Sleep Quality, and Quality of Life Scores.",  
          note = "This table was created with apa_table()")
```
```{r Figure 5}
opts_chunk$set(fig.width = 5, fig.height = 10)

#Scatterplot of sleep quality vs. depression
sp1 <- ggplot(data_p, aes(x = sq_total, y = mdd_total)) + 
              geom_point(position = position_jitter(w = 0.1, h = 0), alpha = 0.7) + 
              geom_smooth(method = "lm") +
              labs(x = "Sleep Quality", 
                   y = "Depression")

#Scatterplot of quality of life vs. depression
sp2 <- ggplot(data_p, aes(x = sq_total, y = ql_total)) + 
              geom_point(position = position_jitter(w = 0.1, h = 0), alpha = 0.7) + 
              geom_smooth(method = "lm") +
              labs(x = "Sleep Quality", 
                   y = "Quality of Life")

#Scatterplot of quality of life vs. depression
sp3 <- ggplot(data_p, aes(x = ql_total, y = mdd_total)) + 
              geom_point(position = position_jitter(w = 0.1, h = 0), alpha = 0.7) + 
              geom_smooth(method = "lm") +
              labs(x = "Quality of Life", 
                   y = "Depression")

#Facet wrap three plots
sp_grid <- grid.arrange(sp1, sp2, sp3, 
                        ncol = 1,
                        top = "The Association between Study Measures in Low SES Individuals")

```




# Discussion


\newpage

# References
```{r create_r-references}
r_refs(file = "r-references.bib")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup
